<template>
    <div id="edit">
        <form id="editCaseForm" name="editCaseForm" role="form" submit.delegate="update(data['id'])">
            <input type="hidden" name="_token" value.bind="data['token']"]>
            <input type="hidden" id="id" value.bind="data['case']['id']" name="data[id]" >
            <div class="row">
                <div class="col-sm-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <div class="personHeading">
                                <span>Case</span>
                                <span class="submitContainer float-right">
                                    <button if.bind="user.role !== 'facilitator'" class="btn  btn-default btn-success edit-button show-button" click.delegate="edit()">Edit Case</button>
                                    <button if.bind="user.role !== 'facilitator'" class="btn  btn-default btn-danger update-button" type="submit">Update Case</button>
                                </span>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div repeat.for="item of caseFieldData">
                                <require from="ObjectKeysValueConverter"></require>
                                <div>
                                    <div repeat.for="prop of item | objectKeys">
                                        <div class="clearfix" if.bind="$index % 3 == 0 && $index !== 0"></div>
                                        <div if.bind="prop.type == 'input'">
                                            <div class="col-sm-4">
                                                <div>
                                                    <label for="${prop.name}">${prop.namePretty} </label>
                                                </div>
                                                <div>
                                                    <span class="inputField">
                                                        <input type="text" name="${prop.name}" id="${prop.name}" value.bind="data[prop.name]" placeholder="${prop.placeholder}" data-date="${prop.date}" readonly>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        <div if.bind="prop.type  == 'select'">
                                            <div class="col-sm-4 inputContainer">
                                                <div>
                                                    <label for="${prop.name}">${prop.namePretty} </label>
                                                </div>
                                                <div class="inputField">

                                                    <select name="${prop.name}" id="${prop.name}" value.bind="data[prop.name]" disabled>
                                                        <option repeat.for="option of prop.options | objectKeys" value="${option.value}">${option.name}</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div if.bind="prop.type == 'textarea'">
                                            <div class="col-sm-6">
                                                <div>
                                                    <label for="${prop.name}">${prop.namePretty} </label>
                                                </div>
                                               <span class="inputField textAreaField">
                                                    <textarea rows="10" name="caseFieldData[case][${prop.name}]" id="${prop.name}"  value.bind="data[prop.name]" readonly></textarea>
                                               </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="clearfix"></div>
                                    <div class="col-sm-6">
                                        <div class="charge-select-wrapper">
                                            <div class="charge-select2-container">
                                                <require from="resources/custom-select"></require>

                                                <div>
                                                    <label for="charges">Charge(s): </label>
                                                </div>
                                                <div class="inputField">
                                                    <select disabled="true" id="charges" class="chargeSelect" select2.bind="options" value.bind="data['charges']" selected.bind="selectedCharge" multiple="multiple" name="data[charge][]">
                                                        <option repeat.for="charge of charges" model.bind="charge.id" id="${charge.id}" value="${charge.id}">${charge.charges}</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-sm-3">
                                        <div class="facilitator-select-wrapper">
                                            <div class="facilitator-select2-container">
                                                <require from="resources/custom-select"></require>

                                                <div>
                                                    <label for="facilitators">Facilitator(s): </label>
                                                </div>
                                                <div class="inputField">
                                                    <select disabled="true" id="facilitators" class="facilitatorSelect" select2.bind="options" value.bind="data['facilitators']" selected.bind="selectedFacilitator" multiple="multiple" name="data[facilitator][]">
                                                        <option repeat.for="facilitator of facilitators" model.bind="facilitator.id" id="${facilitator.id}" value="${facilitator.id}">${facilitator.username}</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="victimSection">
                <section id="victim">
                    <div if.bind="data.victims.length !== 0" repeat.for="victim of data.victims">
                        <div class="index" style="visibility: hidden;">${$parentIndex = $index}</div>
                        <div repeat.for="item of victimFieldData">
                            <div id="victim-${$parentIndex}" class="panel panel-default">
                                <div class="panel-heading">Victim ${$parentIndex + 1}</div>
                                <div class="panel-body">
                                    <div class="row">
                                        <div repeat.for="prop of item | objectKeys">
                                            <div class="clearfix" if.bind="prop.clearfix == 'true'"></div>
                                            <div class="col-sm-4">
                                                <div if.bind="prop.type !== 'textarea'">
                                                    <label for="victim-${prop.name}-${$parentIndex}">${prop.namePretty}: </label>
                                                </div>
                                                <div>
                                                    <div class="inputField" if.bind="prop.type  == 'input'">
                                                        <input type="text" name="${prop.name}" id="victim-${prop.name}-${$parentIndex}" value.bind="data['victims'][$parentIndex][prop.name]" placeholder="${prop.placeholder}" data-date="${prop.date}" readonly>
                                                    </div>

                                                    <div class="inputField" if.bind="prop.type  == 'select'">
                                                        <select name="${prop.name}" id="victim-${prop.name}-${$parentIndex}" value.bind="data['victims'][$parentIndex][prop.name]" disabled>
                                                            <option repeat.for="option of prop.options | objectKeys">${option.name}</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <div if.bind="prop.type == 'textarea'">
                                                <div class="clearfix"></div>
                                                <div class="col-sm-6">
                                                    <div>
                                                        <label for="${prop.name}">${prop.namePretty}: </label>
                                                    </div>
                                                   <span class="inputField textAreaField">
                                                        <textarea rows="10" name="{prop.name}" id="victim-${prop.name}-${$parentIndex}"  value.bind="data['victims'][$parentIndex][prop.name]" readonly></textarea>
                                                   </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div id="offenderSection">
                <section id="offender">
                    <div if.bind="data.offenders.length !== 0" repeat.for="offender of data.offenders">
                        <div class="index" style="visibility: hidden;">${$parentIndex = $index}</div>
                        <div repeat.for="item of offenderFieldData">
                            <div id="offender-${$parentIndex}" class="panel panel-default">
                                <div class="panel-heading">Offender ${$parentIndex + 1}</div>
                                <div class="panel-body">
                                    <div class="row">
                                        <div repeat.for="prop of item | objectKeys">
                                            <div class="clearfix" if.bind="prop.clearfix == 'true'"></div>
                                            <div class="col-sm-4">
                                                <div if.bind="prop.type !== 'textarea'">
                                                    <label for="offender-${prop.name}-${$parentIndex}">${prop.namePretty}: </label>
                                                </div>
                                                <div>
                                                    <div class="inputField" if.bind="prop.type  == 'input'">
                                                        <input type="text" name="${prop.name}" id="offender-${prop.name}-${$parentIndex}" value.bind="data['offenders'][$parentIndex][prop.name]" placeholder="${prop.placeholder}" data-date="${prop.date}" readonly>
                                                    </div>

                                                    <div class="inputField" if.bind="prop.type  == 'select'">
                                                        <select name="${prop.name}" id="offender-${prop.name}-${$parentIndex}" value.bind="data['offenders'][$parentIndex][prop.name]" disabled>
                                                            <option repeat.for="option of prop.options | objectKeys">${option.name}</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <div if.bind="prop.type == 'textarea'">
                                                <div class="clearfix"></div>
                                                <div class="col-sm-6">
                                                    <div>
                                                        <label for="${prop.name}">${prop.namePretty}: </label>
                                                    </div>
                                                   <span class="inputField textAreaField">
                                                        <textarea rows="10" name="{prop.name}" id="offender-${prop.name}-${$parentIndex}"  value.bind="data['offenders'][$parentIndex][prop.name]" readonly></textarea>
                                                   </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </form>

        <div id="fileSection">
            <form id="fileUploadForm" name="fileUploadForm" role="form" submit.delegate="fileUpload()" accept-charset="UTF-8" enctype="multipart/form-data" method="post">
                <require from="FileListToArrayValueConverter"></require>
                <div class="panel panel-default">
                    <div class="panel-heading">Case Files</div>
                    <div class="panel-body">
                        <input type="hidden" id="id" value.bind="data[id]" name="data[id]" >
                        <div class="row">
                            <div show.bind="fileSuccess">File Uploaded Successfully!</div>
                            <div class="fileError"></div>
                            <div class="col-sm-4">
                                <input type="file" multiple files.bind="selectedFiles">
                                <button type="submit" class="btn btn-lg btn-default btn-warning">Upload</button>
                            </div>
                            <div class="col-sm-8">
                                <table id="filesTable" class="table">
                                    <thead>
                                    <tr>
                                        <th>File Name</th>
                                        <th>Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr repeat.for="file of uploadedFiles | fileListToArray">
                                        <td>
                                            ${file.filename}
                                        </td>
                                        <td>
                                            <a href="/uploads/${file.filename} " download><span class="btn btn-success">Download</span></a>
                                            <a click.delegate="deleteFile(file.id, $index)"><span class="btn btn-danger">Delete</span></a>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div id="noteSection">
            <form id="noteForm" name="noteForm" role="form" submit.delegate="addNote()" method="post">
                <div class="panel panel-default">
                    <div class="panel-heading">Add Note</div>
                    <div class="panel-body">
                        <input type="hidden" type="text" value.bind="data[id]" name="data[id]">
                        <div class="row">
                            <div show.bind="noteSuccess">Note Added Successfully!</div>
                            <div class="col-sm-12">
                                <div class="row">
                                    <div class="col-sm-3">
                                        <div>
                                            <label for="noteDate">Note Date: </label>
                                        </div>
                                        <span class="inputField">
                                            <input type="text" id="noteDate" value.bind="noteData.noteDate" name="noteDate" data-date="true" placeholder="MM/DD/YYYY">
                                        </span>
                                    </div>

                                    <div class="col-sm-3">
                                        <div>
                                            <label for="noteContact">Note Contact: </label>
                                        </div>
                                        <span class="inputField">
                                            <input id="noteContact" value.bind="noteData.noteContact" name="noteContact">
                                        </span>
                                    </div>

                                    <div class="col-sm-3">
                                        <div>
                                            <label for="noteContactType">Note Contact Type: </label>
                                        </div>
                                        <span class="inputField">
                                            <input id="noteContactType" value.bind="noteData.noteContactType" name="noteContactType">
                                        </span>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6">
                                        <div>
                                            <label for="noteContent">Note Content: </label>
                                        </div>
                                        <span class="inputField textAreaField">
                                            <textarea rows="10" id="noteContent" value.bind="noteData.noteContent" name="noteContent"></textarea>
                                        </span>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-lg btn-default btn-info">Add Note</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <div class="panel panel-default">
                <div class="panel-heading">Case Notes</div>
                <div class="panel-body">
                    <div class="col-sm-12">
                        <table id="notesTable" class="table">
                            <thead>
                            <tr>
                                <th class="col-sm-2">Added By</th>
                                <th class="col-sm-2">Note Date</th>
                                <th class="col-sm-2">Contact Name</th>
                                <th class="col-sm-2">Contact Type</th>
                                <th>Note Contents</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr repeat.for="note of notes">
                                <td>
                                    <div>${note.userName}</div>
                                </td>
                                <td>
                                    <div if.bind="user.role == 'facilitator'">${note.noteDate}</div>
                                    <div if.bind="user.role !== 'facilitator'">
                                        <a class="editableInput" data-index="${$index}" data-name="noteDate" data-date="true">${note.noteDate}</a>
                                        <input class="inlineEdit hide" name="noteDate" type="text" value="${note.noteDate}">
                                    </div>
                                </td>
                                <td>
                                    <div if.bind="user.role == 'facilitator'">${note.noteContact}</div>
                                    <div if.bind="user.role !== 'facilitator'">
                                        <a class="editableInput" data-index="${$index}" data-name="noteContact">${note.noteContact}</a>
                                        <input class="inlineEdit hide" name="noteContact" type="text" value="${note.noteContact}">
                                    </div>
                                </td>
                                <td>
                                    <div if.bind="user.role == 'facilitator'">${note.noteContactType}</div>
                                    <div if.bind="user.role !== 'facilitator'">
                                        <a class="editableInput" data-index="${$index}" data-name="noteContactType">${note.noteContactType}</a>
                                        <input class="inlineEdit hide" name="noteContactType" type="text" value="${note.noteContactType}">
                                    </div>
                                </td>
                                <td>
                                    <div if.bind="user.role == 'facilitator'">${note.noteContent}</div>
                                    <div if.bind="user.role !== 'facilitator'">
                                        <a class="editableInput" data-index="${$index}" data-name="noteContent">${note.noteContent}</a>
                                        <textarea rows="10" class="inlineEdit hide" name="noteContent" type="text" value="${note.noteContent}"></textarea>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>